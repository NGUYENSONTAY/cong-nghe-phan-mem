{"ast":null,"code":"import React,{useEffect}from'react';import{useCart}from'../contexts/CartContext';import{useAuth}from'../contexts/AuthContext';import{useNavigate}from'react-router-dom';import{useForm}from'react-hook-form';import{yupResolver}from'@hookform/resolvers/yup';import*as yup from'yup';import{orderAPI}from'../api/orderAPI';import{toast}from'react-toastify';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const schema=yup.object().shape({customerName:yup.string().required('Họ và tên là bắt buộc'),phone:yup.string().required('Số điện thoại là bắt buộc').matches(/(84|0[3|5|7|8|9])+([0-9]{8})\\b/,'Số điện thoại không hợp lệ'),address:yup.string().required('Địa chỉ là bắt buộc'),email:yup.string().email('Email không hợp lệ').required('Email là bắt buộc'),note:yup.string(),paymentMethod:yup.string().oneOf(['COD','ONLINE']).required('Vui lòng chọn phương thức thanh toán')});const CheckoutPage=()=>{const{cart,clearCart}=useCart();const{user,isAuthenticated}=useAuth();const navigate=useNavigate();const{register,handleSubmit,formState:{errors,isSubmitting},setValue}=useForm({resolver:yupResolver(schema),defaultValues:{paymentMethod:'COD'}});useEffect(()=>{if(isAuthenticated&&user){setValue('customerName',user.name);setValue('email',user.email);if(user.phone)setValue('phone',user.phone);if(user.address)setValue('address',user.address);}},[isAuthenticated,user,setValue]);useEffect(()=>{if(cart.items.length===0){toast.info(\"Giỏ hàng của bạn đang trống, không thể thanh toán.\");navigate('/books');}},[cart.items,navigate]);const onSubmit=async data=>{const orderData={...data,items:cart.items.map(item=>({bookId:item._id,quantity:item.quantity}))};try{await orderAPI.createOrder(orderData);toast.success('Đặt hàng thành công! Cảm ơn bạn đã mua sắm.');clearCart();navigate('/orders');// Chuyển đến trang lịch sử đơn hàng\n}catch(error){toast.error(error.message||'Đã có lỗi xảy ra khi đặt hàng.');}};return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-100 py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold mb-8 text-center\",children:\"Thanh to\\xE1n\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),className:\"grid grid-cols-1 lg:grid-cols-3 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 bg-white rounded-lg shadow-md p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"Th\\xF4ng tin giao h\\xE0ng\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"customerName\",className:\"block text-sm font-medium text-gray-700\",children:\"H\\u1ECD v\\xE0 t\\xEAn\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"customerName\",...register('customerName'),className:`mt-1 input input-bordered w-full ${errors.customerName?'input-error':''}`}),errors.customerName&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm mt-1\",children:errors.customerName.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",className:\"block text-sm font-medium text-gray-700\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",...register('email'),className:`mt-1 input input-bordered w-full ${errors.email?'input-error':''}`}),errors.email&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm mt-1\",children:errors.email.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"phone\",className:\"block text-sm font-medium text-gray-700\",children:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",id:\"phone\",...register('phone'),className:`mt-1 input input-bordered w-full ${errors.phone?'input-error':''}`}),errors.phone&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm mt-1\",children:errors.phone.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"address\",className:\"block text-sm font-medium text-gray-700\",children:\"\\u0110\\u1ECBa ch\\u1EC9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"address\",...register('address'),className:`mt-1 input input-bordered w-full ${errors.address?'input-error':''}`}),errors.address&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm mt-1\",children:errors.address.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"note\",className:\"block text-sm font-medium text-gray-700\",children:\"Ghi ch\\xFA (t\\xF9y ch\\u1ECDn)\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"note\",...register('note'),className:\"mt-1 textarea textarea-bordered w-full\",rows:3})]})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mt-8 mb-4\",children:\"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center p-4 border rounded-lg cursor-pointer has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"COD\",...register('paymentMethod'),className:\"radio radio-primary\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-4 font-medium\",children:\"Thanh to\\xE1n khi nh\\u1EADn h\\xE0ng (COD)\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center p-4 border rounded-lg cursor-pointer has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-400\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"ONLINE\",...register('paymentMethod'),className:\"radio radio-primary\",disabled:true}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-4 font-medium text-gray-400\",children:\"Chuy\\u1EC3n kho\\u1EA3n / V\\xED \\u0111i\\u1EC7n t\\u1EED (\\u0110ang ph\\xE1t tri\\u1EC3n)\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6 sticky top-24\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"\\u0110\\u01A1n h\\xE0ng c\\u1EE7a b\\u1EA1n\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 max-h-64 overflow-y-auto pr-2\",children:cart.items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.image||'/placeholder-image.png',alt:item.title,className:\"w-12 h-16 object-cover rounded mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold leading-tight\",children:item.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-500\",children:[\"x \",item.quantity]})]})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[(item.price*item.quantity).toLocaleString('vi-VN'),\" \\u20AB\"]})]},item._id))}),/*#__PURE__*/_jsx(\"hr\",{className:\"my-4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between font-bold text-lg\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"T\\u1ED5ng ti\\u1EC1n\"}),/*#__PURE__*/_jsxs(\"span\",{children:[cart.totalAmount.toLocaleString('vi-VN'),\" \\u20AB\"]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 w-full mt-6 disabled:opacity-50 disabled:cursor-not-allowed\",disabled:isSubmitting,children:isSubmitting?'Đang xử lý...':'Xác nhận đặt hàng'})]})})]})]})});};export default CheckoutPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}