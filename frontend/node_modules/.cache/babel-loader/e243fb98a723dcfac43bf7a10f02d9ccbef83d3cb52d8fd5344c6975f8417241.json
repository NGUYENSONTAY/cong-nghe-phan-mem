{"ast":null,"code":"import React,{useState}from'react';import{useQuery,useMutation,useQueryClient}from'react-query';import{Link,useSearchParams}from'react-router-dom';import toast from'react-hot-toast';import{FaEdit,FaTrash}from'react-icons/fa';import{booksAPI}from'../../api/booksAPI';import Loading from'../../components/common/Loading';import Pagination from'../../components/common/Pagination';import{ConfirmModal}from'../../components/common/Modal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminBookManagement=()=>{const queryClient=useQueryClient();const[searchParams,setSearchParams]=useSearchParams();// State for delete confirmation modal\nconst[isModalOpen,setIsModalOpen]=useState(false);const[bookToDelete,setBookToDelete]=useState(null);const page=parseInt(searchParams.get('page')||'1',10);const limit=10;const{data:booksResponse,isLoading,isError,error}=useQuery(['adminBooks',page],()=>booksAPI.getBooks(page-1,limit,{sortBy:'createdAt',sortDir:'desc'}),{keepPreviousData:true});const deleteMutation=useMutation(booksAPI.deleteBook,{onSuccess:()=>{toast.success('Xóa sách thành công!');queryClient.invalidateQueries('adminBooks');closeDeleteModal();},onError:err=>{toast.error(`Lỗi khi xóa sách: ${err.message}`);closeDeleteModal();}});const openDeleteModal=book=>{setBookToDelete(book);setIsModalOpen(true);};const closeDeleteModal=()=>{setBookToDelete(null);setIsModalOpen(false);};const handleDeleteBook=()=>{if(bookToDelete){deleteMutation.mutate(bookToDelete._id);}};const handlePageChange=newPage=>{setSearchParams({page:newPage.toString()});};const formatPrice=price=>{return new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND'}).format(price);};const renderContent=()=>{if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center p-12\",children:/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i danh s\\xE1ch s\\xE1ch...\"})});}if(isError){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center p-12 text-red-500\",children:error.message});}if(!booksResponse||booksResponse.data.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center p-12\",children:\"Kh\\xF4ng c\\xF3 s\\xE1ch n\\xE0o.\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"table w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u1EA2nh\"}),/*#__PURE__*/_jsx(\"th\",{children:\"T\\xEAn s\\xE1ch\"}),/*#__PURE__*/_jsx(\"th\",{children:\"T\\xE1c gi\\u1EA3\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Danh m\\u1EE5c\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-right\",children:\"Gi\\xE1\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-right\",children:\"T\\u1ED3n kho\"}),/*#__PURE__*/_jsx(\"th\",{className:\"text-center\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:booksResponse.data.map(book=>{var _book$category;return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover\",children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"img\",{src:book.images[0]||'/placeholder-image.png',alt:book.title,className:\"w-12 h-16 object-cover rounded\",onError:e=>{e.currentTarget.src='/placeholder-image.png';}})}),/*#__PURE__*/_jsx(\"td\",{className:\"font-semibold\",children:book.title}),/*#__PURE__*/_jsx(\"td\",{children:book.author}),/*#__PURE__*/_jsx(\"td\",{children:((_book$category=book.category)===null||_book$category===void 0?void 0:_book$category.name)||'N/A'}),/*#__PURE__*/_jsx(\"td\",{className:\"text-right\",children:formatPrice(book.price)}),/*#__PURE__*/_jsx(\"td\",{className:\"text-right\",children:book.quantity}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center gap-2\",children:[/*#__PURE__*/_jsx(Link,{to:`/admin/books/edit/${book._id}`,className:\"btn btn-ghost btn-sm\",children:/*#__PURE__*/_jsx(FaEdit,{})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openDeleteModal(book),className:\"btn btn-ghost btn-sm text-red-600\",children:/*#__PURE__*/_jsx(FaTrash,{})})]})})]},book._id);})})]})});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:\"Qu\\u1EA3n l\\xFD S\\xE1ch\"}),/*#__PURE__*/_jsx(Link,{to:\"/admin/books/add\",className:\"btn btn-primary\",children:\"Th\\xEAm s\\xE1ch m\\u1EDBi\"})]}),renderContent(),booksResponse&&booksResponse.totalPages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 flex justify-center\",children:/*#__PURE__*/_jsx(Pagination,{currentPage:booksResponse.currentPage+1,totalPages:booksResponse.totalPages,onPageChange:handlePageChange})}),bookToDelete&&/*#__PURE__*/_jsx(ConfirmModal,{isOpen:isModalOpen,onClose:closeDeleteModal,onConfirm:handleDeleteBook,title:\"X\\xE1c nh\\u1EADn x\\xF3a s\\xE1ch\",message:`Bạn có chắc chắn muốn xóa sách \"${bookToDelete.title}\"? Hành động này không thể hoàn tác.`,variant:\"danger\",confirmText:\"X\\xF3a\"})]});};export default AdminBookManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}