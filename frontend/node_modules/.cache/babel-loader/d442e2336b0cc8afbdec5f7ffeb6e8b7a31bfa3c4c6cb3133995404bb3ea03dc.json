{"ast":null,"code":"import React,{useState,useEffect}from'react';import{uploadAPI}from'../../api/uploadAPI';import toast from'react-hot-toast';import Loading from'../common/Loading';import Modal from'../common/Modal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ImageGallery=_ref=>{let{onImageSelect,showSelectButton=false,className=''}=_ref;const[images,setImages]=useState([]);const[loading,setLoading]=useState(true);const[selectedImage,setSelectedImage]=useState(null);const[showDeleteModal,setShowDeleteModal]=useState(false);const[imageToDelete,setImageToDelete]=useState(null);const[page,setPage]=useState(0);const[hasMore,setHasMore]=useState(true);useEffect(()=>{loadImages();},[]);const loadImages=async function(){let currentPage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;try{setLoading(true);const response=await uploadAPI.getImages(currentPage,20);if(currentPage===0){setImages(response);}else{setImages(prev=>[...prev,...response]);}setHasMore(response.length===20);setPage(currentPage);}catch(error){toast.error('Lỗi khi tải danh sách ảnh');console.error('Error loading images:',error);}finally{setLoading(false);}};const loadMore=()=>{if(!loading&&hasMore){loadImages(page+1);}};const handleDeleteImage=async()=>{if(!imageToDelete)return;try{await uploadAPI.deleteImage(imageToDelete);setImages(prev=>prev.filter(img=>img.filename!==imageToDelete));toast.success('Đã xóa ảnh thành công');setShowDeleteModal(false);setImageToDelete(null);}catch(error){toast.error('Lỗi khi xóa ảnh');console.error('Error deleting image:',error);}};const openDeleteModal=filename=>{setImageToDelete(filename);setShowDeleteModal(true);};const closeDeleteModal=()=>{setShowDeleteModal(false);setImageToDelete(null);};const handleImageClick=image=>{setSelectedImage(image);};const closeImageModal=()=>{setSelectedImage(null);};const handleSelectImage=imageUrl=>{if(onImageSelect){onImageSelect(imageUrl);toast.success('Đã chọn ảnh');}};const copyImageUrl=imageUrl=>{navigator.clipboard.writeText(imageUrl);toast.success('Đã copy URL ảnh');};if(loading&&images.length===0){return/*#__PURE__*/_jsx(Loading,{});}return/*#__PURE__*/_jsxs(\"div\",{className:className,children:[images.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"h-12 w-12 text-gray-400 mx-auto mb-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Ch\\u01B0a c\\xF3 \\u1EA3nh n\\xE0o\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"T\\u1EA3i l\\xEAn \\u1EA3nh \\u0111\\u1EA7u ti\\xEAn \\u0111\\u1EC3 b\\u1EAFt \\u0111\\u1EA7u\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4\",children:images.map(image=>/*#__PURE__*/_jsxs(\"div\",{className:\"relative group bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"aspect-square cursor-pointer\",onClick:()=>handleImageClick(image),children:/*#__PURE__*/_jsx(\"img\",{src:uploadAPI.getImageUrl(image.filename),alt:image.filename,className:\"w-full h-full object-cover\",loading:\"lazy\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[showSelectButton&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSelectImage(uploadAPI.getImageUrl(image.filename)),className:\"p-2 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors\",title:\"Ch\\u1ECDn \\u1EA3nh n\\xE0y\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M5 13l4 4L19 7\"})})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>copyImageUrl(uploadAPI.getImageUrl(image.filename)),className:\"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors\",title:\"Copy URL\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"})})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openDeleteModal(image.filename),className:\"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\",title:\"X\\xF3a \\u1EA3nh\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"})})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 truncate\",title:image.filename,children:image.filename}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400\",children:uploadAPI.formatFileSize(image.size)})]})]},image.filename))}),hasMore&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center mt-6\",children:/*#__PURE__*/_jsx(\"button\",{onClick:loadMore,disabled:loading,className:\"btn btn-outline\",children:loading?'Đang tải...':'Tải thêm'})})]}),selectedImage&&/*#__PURE__*/_jsx(Modal,{isOpen:true,onClose:closeImageModal,size:\"lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"img\",{src:uploadAPI.getImageUrl(selectedImage.filename),alt:selectedImage.filename,className:\"w-full h-auto max-h-96 object-contain mx-auto\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"T\\xEAn file:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:selectedImage.filename})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"K\\xEDch th\\u01B0\\u1EDBc:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:uploadAPI.formatFileSize(selectedImage.size)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Ng\\xE0y t\\u1EA3i:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:new Date(selectedImage.lastModified).toLocaleString('vi-VN')})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3 mt-6\",children:[showSelectButton&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{handleSelectImage(uploadAPI.getImageUrl(selectedImage.filename));closeImageModal();},className:\"btn btn-primary\",children:\"Ch\\u1ECDn \\u1EA3nh n\\xE0y\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>copyImageUrl(uploadAPI.getImageUrl(selectedImage.filename)),className:\"btn btn-outline\",children:\"Copy URL\"}),/*#__PURE__*/_jsx(\"button\",{onClick:closeImageModal,className:\"btn btn-outline\",children:\"\\u0110\\xF3ng\"})]})]})}),showDeleteModal&&/*#__PURE__*/_jsx(Modal,{isOpen:true,onClose:closeDeleteModal,children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-4\",children:\"X\\xE1c nh\\u1EADn x\\xF3a \\u1EA3nh\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-6\",children:\"B\\u1EA1n c\\xF3 ch\\u1EAFc ch\\u1EAFn mu\\u1ED1n x\\xF3a \\u1EA3nh n\\xE0y kh\\xF4ng? H\\xE0nh \\u0111\\u1ED9ng n\\xE0y kh\\xF4ng th\\u1EC3 ho\\xE0n t\\xE1c.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:closeDeleteModal,className:\"btn btn-outline\",children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDeleteImage,className:\"btn btn-danger\",children:\"X\\xF3a\"})]})]})})]});};export default ImageGallery;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}