{"ast":null,"code":"import React,{useState}from'react';import{useQuery,useMutation,useQueryClient}from'react-query';import{useSearchParams}from'react-router-dom';import{userAPI}from'../../api/userAPI';import Pagination from'../../components/common/Pagination';import Loading from'../../components/common/Loading';import toast from'react-hot-toast';import{useAuth}from'../../contexts/AuthContext';import{FaUser,FaSearch,FaFilter,FaEnvelope,FaPhone,FaMapMarkerAlt,FaCalendar,FaEdit,FaCrown,FaUsers,FaUserCheck}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminUserManagement=()=>{const queryClient=useQueryClient();const[searchParams,setSearchParams]=useSearchParams();const{user:currentUser}=useAuth();// State for search and filters\nconst[searchTerm,setSearchTerm]=useState(searchParams.get('search')||'');const[selectedRole,setSelectedRole]=useState(searchParams.get('role')||'');const[showFilters,setShowFilters]=useState(false);const currentPage=parseInt(searchParams.get('page')||'1',10);const{data:response,isLoading,error}=useQuery(['adminUsers',currentPage,searchTerm,selectedRole],()=>userAPI.getAllUsers(currentPage-1,10));const users=response===null||response===void 0?void 0:response.data;const totalPages=(response===null||response===void 0?void 0:response.totalPages)||0;const updateUserMutation=useMutation(_ref=>{let{userId,data}=_ref;return userAPI.updateUser(userId,data);},{onSuccess:updatedUser=>{toast.success(`Cập nhật vai trò cho ${updatedUser.name} thành công!`);queryClient.invalidateQueries(['adminUsers',currentPage]);},onError:err=>{toast.error(`Lỗi: ${err.message}`);}});const handleRoleChange=(userId,newRole)=>{if(userId===(currentUser===null||currentUser===void 0?void 0:currentUser._id)){toast.error('Bạn không thể thay đổi vai trò của chính mình.');return;}updateUserMutation.mutate({userId,data:{role:newRole}});};const handlePageChange=page=>{const params=new URLSearchParams(searchParams);params.set('page',page.toString());setSearchParams(params);};const handleSearch=e=>{e.preventDefault();const params=new URLSearchParams();params.set('page','1');if(searchTerm)params.set('search',searchTerm);if(selectedRole)params.set('role',selectedRole);setSearchParams(params);};const clearFilters=()=>{setSearchTerm('');setSelectedRole('');setSearchParams({});};const filteredUsers=(users===null||users===void 0?void 0:users.filter(user=>{var _user$phone,_user$address;const matchesSearch=user.name.toLowerCase().includes(searchTerm.toLowerCase())||user.email.toLowerCase().includes(searchTerm.toLowerCase())||((_user$phone=user.phone)===null||_user$phone===void 0?void 0:_user$phone.toLowerCase().includes(searchTerm.toLowerCase()))||((_user$address=user.address)===null||_user$address===void 0?void 0:_user$address.toLowerCase().includes(searchTerm.toLowerCase()));const matchesRole=!selectedRole||user.role===selectedRole;return matchesSearch&&matchesRole;}))||[];const formatDateTime=dateString=>{return new Date(dateString).toLocaleString('vi-VN');};const getRoleIcon=role=>{return role==='ADMIN'?/*#__PURE__*/_jsx(FaCrown,{className:\"w-4 h-4\"}):/*#__PURE__*/_jsx(FaUser,{className:\"w-4 h-4\"});};const getRoleColor=role=>{return role==='ADMIN'?'bg-purple-100 text-purple-800 border-purple-200':'bg-blue-100 text-blue-800 border-blue-200';};const getRoleText=role=>{return role==='ADMIN'?'Quản trị viên':'Người dùng';};const calculateStats=()=>{if(!users)return{total:0,admins:0,customers:0};return{total:users.length,admins:users.filter(u=>u.role==='ADMIN').length,customers:users.filter(u=>u.role==='USER').length};};const stats=calculateStats();if(isLoading)return/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i danh s\\xE1ch ng\\u01B0\\u1EDDi d\\xF9ng...\"});if(error)return/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-500\",children:[\"L\\u1ED7i khi t\\u1EA3i ng\\u01B0\\u1EDDi d\\xF9ng: \",error.message]});return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center sm:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:\"Qu\\u1EA3n l\\xFD Ng\\u01B0\\u1EDDi d\\xF9ng\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-1\",children:response?`${response.totalItems.toLocaleString()} người dùng`:'Đang tải...'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 sm:mt-0 flex space-x-3\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowFilters(!showFilters),className:\"px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-md hover:bg-gray-200 flex items-center\",children:[/*#__PURE__*/_jsx(FaFilter,{className:\"w-4 h-4 mr-2\"}),\"B\\u1ED9 l\\u1ECDc\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FaUsers,{className:\"w-8 h-8 text-blue-600\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:\"T\\u1ED5ng ng\\u01B0\\u1EDDi d\\xF9ng\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold text-gray-900\",children:stats.total})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FaCrown,{className:\"w-8 h-8 text-purple-600\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:\"Qu\\u1EA3n tr\\u1ECB vi\\xEAn\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold text-gray-900\",children:stats.admins})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-6 rounded-lg shadow-sm border border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FaUserCheck,{className:\"w-8 h-8 text-green-600\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:\"Kh\\xE1ch h\\xE0ng\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold text-gray-900\",children:stats.customers})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSearch,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(FaSearch,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),placeholder:\"T\\xECm ki\\u1EBFm theo t\\xEAn, email, s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i...\",className:\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"select\",{value:selectedRole,onChange:e=>setSelectedRole(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3 vai tr\\xF2\"}),/*#__PURE__*/_jsx(\"option\",{value:\"USER\",children:\"Kh\\xE1ch h\\xE0ng\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ADMIN\",children:\"Qu\\u1EA3n tr\\u1ECB vi\\xEAn\"})]})})]}),showFilters&&/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700\",children:\"\\xC1p d\\u1EE5ng\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:clearFilters,className:\"px-4 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700\",children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200 text-center text-sm text-gray-500\",children:[\"Hi\\u1EC3n th\\u1ECB \",filteredUsers.length,\" tr\\xEAn \",(users===null||users===void 0?void 0:users.length)||0,\" ng\\u01B0\\u1EDDi d\\xF9ng\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\",children:filteredUsers.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(FaUsers,{className:\"w-16 h-16 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:searchTerm||selectedRole?'Không tìm thấy người dùng':'Chưa có người dùng nào'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:searchTerm||selectedRole?'Thử thay đổi từ khóa tìm kiếm hoặc bộ lọc':'Người dùng sẽ xuất hiện khi họ đăng ký tài khoản'})]}):/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Ng\\u01B0\\u1EDDi d\\xF9ng\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Th\\xF4ng tin li\\xEAn h\\u1EC7\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"\\u0110\\u1ECBa ch\\u1EC9\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Vai tr\\xF2\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Ng\\xE0y t\\u1EA1o\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:filteredUsers.map(user=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 h-10 w-10\",children:/*#__PURE__*/_jsx(\"div\",{className:`h-10 w-10 rounded-full flex items-center justify-center ${user.role==='ADMIN'?'bg-purple-100':'bg-blue-100'}`,children:getRoleIcon(user.role)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium text-gray-900 flex items-center\",children:[user.name,user._id===(currentUser===null||currentUser===void 0?void 0:currentUser._id)&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full\",children:\"B\\u1EA1n\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 flex items-center\",children:[/*#__PURE__*/_jsx(FaEnvelope,{className:\"w-3 h-3 mr-1\"}),user.email]})]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-900\",children:[user.phone&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-1\",children:[/*#__PURE__*/_jsx(FaPhone,{className:\"w-3 h-3 mr-1 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{children:user.phone})]}),!user.phone&&/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 italic text-sm\",children:\"Ch\\u01B0a c\\u1EADp nh\\u1EADt\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-900\",children:user.address?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start\",children:[/*#__PURE__*/_jsx(FaMapMarkerAlt,{className:\"w-3 h-3 mr-1 text-gray-400 mt-0.5\"}),/*#__PURE__*/_jsx(\"span\",{className:\"max-w-xs truncate\",children:user.address})]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 italic\",children:\"Ch\\u01B0a c\\u1EADp nh\\u1EADt\"})})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"span\",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${getRoleColor(user.role)}`,children:[getRoleIcon(user.role),/*#__PURE__*/_jsx(\"span\",{className:\"ml-1\",children:getRoleText(user.role)})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-900\",children:[/*#__PURE__*/_jsx(FaCalendar,{className:\"w-4 h-4 text-gray-400 mr-2\"}),formatDateTime(user.createdAt)]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2\",children:[user._id!==(currentUser===null||currentUser===void 0?void 0:currentUser._id)&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative group\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 flex items-center\",children:[/*#__PURE__*/_jsx(FaEdit,{className:\"w-3 h-3 mr-1\"}),\"Vai tr\\xF2\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"py-1\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleRoleChange(user._id,'USER'),disabled:user.role==='USER',className:`block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 ${user.role==='USER'?'text-gray-400':'text-gray-700'}`,children:[/*#__PURE__*/_jsx(FaUser,{className:\"w-3 h-3 mr-2 inline\"}),\"Kh\\xE1ch h\\xE0ng\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleRoleChange(user._id,'ADMIN'),disabled:user.role==='ADMIN',className:`block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 ${user.role==='ADMIN'?'text-gray-400':'text-gray-700'}`,children:[/*#__PURE__*/_jsx(FaCrown,{className:\"w-3 h-3 mr-2 inline\"}),\"Qu\\u1EA3n tr\\u1ECB vi\\xEAn\"]})]})})]}),user._id===(currentUser===null||currentUser===void 0?void 0:currentUser._id)&&/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 bg-gray-100 text-gray-500 text-sm font-medium rounded\",children:\"T\\xE0i kho\\u1EA3n c\\u1EE7a b\\u1EA1n\"})]})})]},user._id))})]})})}),totalPages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center\",children:/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,totalPages:totalPages,onPageChange:handlePageChange})})]});};export default AdminUserManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}