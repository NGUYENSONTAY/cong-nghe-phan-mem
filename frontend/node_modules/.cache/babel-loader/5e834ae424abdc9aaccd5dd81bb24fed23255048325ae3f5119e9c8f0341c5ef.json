{"ast":null,"code":"import React,{useState}from'react';import{useParams,Link}from'react-router-dom';import{useQuery}from'react-query';import{booksAPI}from'../api/booksAPI';import{useCart}from'../contexts/CartContext';import BookCard from'../components/common/BookCard';import Loading from'../components/common/Loading';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BookDetailPage=()=>{var _relatedBooksResponse;const{id}=useParams();const{addToCart}=useCart();const[quantity,setQuantity]=useState(1);const{data:book,isLoading:isLoadingBook,error}=useQuery(['book',id],()=>booksAPI.getBookById(id),{enabled:!!id});const{data:relatedBooksResponse,isLoading:isLoadingRelated}=useQuery(['relatedBooks',book===null||book===void 0?void 0:book.category._id],()=>booksAPI.getBooks(0,4,{category:book.category._id}),{enabled:!!book});const relatedBooks=relatedBooksResponse===null||relatedBooksResponse===void 0?void 0:(_relatedBooksResponse=relatedBooksResponse.data)===null||_relatedBooksResponse===void 0?void 0:_relatedBooksResponse.filter(relatedBook=>relatedBook._id!==(book===null||book===void 0?void 0:book._id));const handleQuantityChange=change=>{if(!book)return;const newQuantity=quantity+change;if(newQuantity>0&&newQuantity<=book.quantity){setQuantity(newQuantity);}};const handleAddToCart=()=>{if(book){addToCart(book,quantity);toast.success(`Đã thêm ${quantity} cuốn \"${book.title}\" vào giỏ hàng`);}};if(isLoadingBook)return/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i chi ti\\u1EBFt s\\xE1ch...\"});if(error||!book){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-20\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y s\\xE1ch\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-2\",children:\"S\\u1EA3n ph\\u1EA9m b\\u1EA1n t\\xECm ki\\u1EBFm kh\\xF4ng t\\u1ED3n t\\u1EA1i ho\\u1EB7c \\u0111\\xE3 b\\u1ECB x\\xF3a.\"}),/*#__PURE__*/_jsx(Link,{to:\"/books\",className:\"btn btn-primary mt-6\",children:\"Quay l\\u1EA1i trang s\\xE1ch\"})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 py-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-8 rounded-lg shadow-md mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid md:grid-cols-2 gap-8 lg:gap-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-100 rounded-lg flex items-center justify-center p-4\",children:/*#__PURE__*/_jsx(\"img\",{src:book.images[0]||'/placeholder-image.png',alt:book.title,className:\"w-full max-w-sm h-auto object-contain\",onError:e=>{e.currentTarget.src='/placeholder-image.png';}})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Link,{to:`/books?category=${book.category._id}`,className:\"inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mb-4 hover:bg-gray-300\",children:book.category.name}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl lg:text-4xl font-bold text-gray-800 mb-2\",children:book.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg text-gray-600 mb-4\",children:[\"T\\xE1c gi\\u1EA3: \",/*#__PURE__*/_jsx(\"span\",{className:\"text-indigo-600 font-medium\",children:book.author})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-3xl font-bold text-red-600 mb-6\",children:[book.price.toLocaleString('vi-VN'),\" \\u20AB\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"prose max-w-none text-gray-600 mb-6\",children:/*#__PURE__*/_jsx(\"p\",{children:book.description})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 mb-6\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"S\\u1ED1 l\\u01B0\\u1EE3ng:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center border rounded\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleQuantityChange(-1),className:\"px-3 py-1\",children:\"-\"}),/*#__PURE__*/_jsx(\"span\",{className:\"px-4 py-1\",children:quantity}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleQuantityChange(1),className:\"px-3 py-1\",children:\"+\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500\",children:[\"(\",book.quantity,\" s\\u1EA3n ph\\u1EA9m c\\xF3 s\\u1EB5n)\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleAddToCart,disabled:book.quantity===0,className:\"bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 disabled:opacity-50\",children:book.quantity>0?'Thêm vào giỏ hàng':'Hết hàng'})]})]})}),relatedBooks&&relatedBooks.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-6\",children:\"S\\xE1ch li\\xEAn quan\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\",children:relatedBooks.map(relatedBook=>/*#__PURE__*/_jsx(BookCard,{book:relatedBook},relatedBook._id))})]})]})});};export default BookDetailPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}