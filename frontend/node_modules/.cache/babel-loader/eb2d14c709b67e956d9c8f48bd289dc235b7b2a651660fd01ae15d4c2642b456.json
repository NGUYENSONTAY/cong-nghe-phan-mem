{"ast":null,"code":"import React from'react';import{useQuery,useMutation,useQueryClient}from'react-query';import{useSearchParams}from'react-router-dom';import{userAPI}from'../../api/userAPI';import Pagination from'../../components/common/Pagination';import Loading from'../../components/common/Loading';import{toast}from'react-toastify';import{useAuth}from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminUserManagement=()=>{const queryClient=useQueryClient();const[searchParams,setSearchParams]=useSearchParams();const{user:currentUser}=useAuth();const currentPage=parseInt(searchParams.get('page')||'1',10);const{data:response,isLoading,error}=useQuery(['adminUsers',currentPage],()=>userAPI.getAllUsers(currentPage-1,10));const users=response===null||response===void 0?void 0:response.data;const totalPages=(response===null||response===void 0?void 0:response.totalPages)||0;const updateUserMutation=useMutation(_ref=>{let{userId,data}=_ref;return userAPI.updateUser(userId,data);},{onSuccess:updatedUser=>{toast.success(`Cập nhật vai trò cho ${updatedUser.name} thành công!`);queryClient.invalidateQueries(['adminUsers',currentPage]);},onError:err=>{toast.error(`Lỗi: ${err.message}`);}});const handleRoleChange=(userId,newRole)=>{if(userId===(currentUser===null||currentUser===void 0?void 0:currentUser._id)){toast.warn('Bạn không thể thay đổi vai trò của chính mình.');return;}updateUserMutation.mutate({userId,data:{role:newRole}});};const handlePageChange=page=>{setSearchParams({page:page.toString()});};if(isLoading)return/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i danh s\\xE1ch ng\\u01B0\\u1EDDi d\\xF9ng...\"});if(error)return/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-500\",children:[\"L\\u1ED7i khi t\\u1EA3i ng\\u01B0\\u1EDDi d\\xF9ng: \",error.message]});return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-800 mb-6\",children:\"Qu\\u1EA3n L\\xFD Ng\\u01B0\\u1EDDi D\\xF9ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow overflow-hidden\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"py-3 px-6 text-left\",children:\"T\\xEAn\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-3 px-6 text-left\",children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-3 px-6 text-left\",children:\"Ng\\xE0y tham gia\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-3 px-6 text-center\",children:\"Vai tr\\xF2\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-gray-200\",children:users===null||users===void 0?void 0:users.map(user=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 font-medium\",children:user.name}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6\",children:user.email}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6\",children:new Date(user.createdAt).toLocaleDateString('vi-VN')}),/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 text-center\",children:/*#__PURE__*/_jsxs(\"select\",{value:user.role,onChange:e=>handleRoleChange(user._id,e.target.value),disabled:updateUserMutation.isLoading||user._id===(currentUser===null||currentUser===void 0?void 0:currentUser._id),className:`p-1 rounded-md text-sm border-2 ${user.role==='ADMIN'?'border-red-500':'border-gray-300'}`,children:[/*#__PURE__*/_jsx(\"option\",{value:\"USER\",children:\"USER\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ADMIN\",children:\"ADMIN\"})]})})]},user._id))})]})}),totalPages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 flex justify-center\",children:/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,totalPages:totalPages,onPageChange:handlePageChange})})]});};export default AdminUserManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}