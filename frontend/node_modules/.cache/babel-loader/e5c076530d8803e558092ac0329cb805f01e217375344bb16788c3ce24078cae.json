{"ast":null,"code":"import React,{useState}from'react';import{useQuery,useMutation,useQueryClient}from'react-query';import{Link,useSearchParams}from'react-router-dom';import toast from'react-hot-toast';import{FaEdit,FaTrash,FaPlus,FaSearch,FaFilter,FaEye,FaTags,FaUser,FaBook}from'react-icons/fa';import{booksAPI}from'../../api/booksAPI';import{categoryAPI}from'../../api/categoryAPI';import Loading from'../../components/common/Loading';import Pagination from'../../components/common/Pagination';import{ConfirmModal}from'../../components/common/Modal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AdminBookManagement=()=>{var _booksResponse$data,_booksResponse$data2,_booksResponse$data3;const queryClient=useQueryClient();const[searchParams,setSearchParams]=useSearchParams();// State for search and filters\nconst[searchTerm,setSearchTerm]=useState(searchParams.get('search')||'');const[selectedCategory,setSelectedCategory]=useState(searchParams.get('category')||'');const[sortBy,setSortBy]=useState(searchParams.get('sortBy')||'createdAt');const[sortDir,setSortDir]=useState(searchParams.get('sortDir')||'desc');const[showFilters,setShowFilters]=useState(false);// State for delete confirmation modal\nconst[isModalOpen,setIsModalOpen]=useState(false);const[bookToDelete,setBookToDelete]=useState(null);// State for bulk operations\nconst[selectedBooks,setSelectedBooks]=useState([]);const page=parseInt(searchParams.get('page')||'1',10);const limit=12;// Get categories for filter dropdown\nconst{data:categories}=useQuery('categories',categoryAPI.getAllCategories);const{data:booksResponse,isLoading,isError,error}=useQuery(['adminBooks',page,searchTerm,selectedCategory,sortBy,sortDir],()=>booksAPI.getBooks(page-1,limit,{title:searchTerm||undefined,category:selectedCategory||undefined,sortBy,sortDir}),{keepPreviousData:true});const deleteMutation=useMutation(booksAPI.deleteBook,{onSuccess:()=>{toast.success('Xóa sách thành công!');queryClient.invalidateQueries('adminBooks');closeDeleteModal();},onError:err=>{toast.error(`Lỗi khi xóa sách: ${err.message}`);closeDeleteModal();}});const formatCurrency=price=>{return new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND'}).format(price);};const openDeleteModal=book=>{setBookToDelete(book);setIsModalOpen(true);};const closeDeleteModal=()=>{setBookToDelete(null);setIsModalOpen(false);};const handleDeleteBook=()=>{if(bookToDelete){deleteMutation.mutate(bookToDelete._id);}};const handlePageChange=newPage=>{const params=new URLSearchParams(searchParams);params.set('page',newPage.toString());setSearchParams(params);};const handleSearch=e=>{e.preventDefault();const params=new URLSearchParams();params.set('page','1');if(searchTerm)params.set('search',searchTerm);if(selectedCategory)params.set('category',selectedCategory);if(sortBy!=='createdAt')params.set('sortBy',sortBy);if(sortDir!=='desc')params.set('sortDir',sortDir);setSearchParams(params);};const handleFilterChange=()=>{const params=new URLSearchParams();params.set('page','1');if(searchTerm)params.set('search',searchTerm);if(selectedCategory)params.set('category',selectedCategory);if(sortBy!=='createdAt')params.set('sortBy',sortBy);if(sortDir!=='desc')params.set('sortDir',sortDir);setSearchParams(params);};const clearFilters=()=>{setSearchTerm('');setSelectedCategory('');setSortBy('createdAt');setSortDir('desc');setSearchParams({});};const toggleBookSelection=bookId=>{setSelectedBooks(prev=>prev.includes(bookId)?prev.filter(id=>id!==bookId):[...prev,bookId]);};const selectAllBooks=()=>{if(booksResponse!==null&&booksResponse!==void 0&&booksResponse.data){setSelectedBooks(booksResponse.data.map(book=>book._id));}};const clearSelection=()=>{setSelectedBooks([]);};const getStockStatus=quantity=>{if(quantity===0)return{text:'Hết hàng',color:'text-red-600 bg-red-50'};if(quantity<10)return{text:'Sắp hết',color:'text-yellow-600 bg-yellow-50'};return{text:'Còn hàng',color:'text-green-600 bg-green-50'};};const renderContent=()=>{if(isLoading)return/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i danh s\\xE1ch s\\xE1ch...\"});if(isError)return/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-500\",children:[\"L\\u1ED7i: \",error===null||error===void 0?void 0:error.message]});if(!(booksResponse!==null&&booksResponse!==void 0&&booksResponse.data)||booksResponse.data.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(FaBook,{className:\"w-16 h-16 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Kh\\xF4ng c\\xF3 s\\xE1ch n\\xE0o\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-6\",children:\"B\\u1EAFt \\u0111\\u1EA7u b\\u1EB1ng c\\xE1ch th\\xEAm s\\xE1ch m\\u1EDBi v\\xE0o h\\u1EC7 th\\u1ED1ng.\"}),/*#__PURE__*/_jsxs(Link,{to:\"/admin/books/new\",className:\"inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700\",children:[/*#__PURE__*/_jsx(FaPlus,{className:\"w-4 h-4 mr-2\"}),\"Th\\xEAm s\\xE1ch m\\u1EDBi\"]})]});}return/*#__PURE__*/_jsxs(_Fragment,{children:[selectedBooks.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-blue-700\",children:[\"\\u0110\\xE3 ch\\u1ECDn \",selectedBooks.length,\" s\\xE1ch\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700\",children:\"X\\xF3a \\u0111\\u01B0\\u1EE3c ch\\u1ECDn\"}),/*#__PURE__*/_jsx(\"button\",{onClick:clearSelection,className:\"px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700\",children:\"B\\u1ECF ch\\u1ECDn\"})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:booksResponse.data.map(book=>{var _book$images,_book$category;const stockStatus=getStockStatus(book.quantity);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedBooks.includes(book._id),onChange:()=>toggleBookSelection(book._id),className:\"absolute top-2 left-2 z-10\"}),/*#__PURE__*/_jsx(\"img\",{src:((_book$images=book.images)===null||_book$images===void 0?void 0:_book$images[0])||'/placeholder-book.jpg',alt:book.title,className:\"w-full h-48 object-cover\"}),/*#__PURE__*/_jsx(\"div\",{className:`absolute top-2 right-2 px-2 py-1 rounded text-xs font-medium ${stockStatus.color}`,children:stockStatus.text})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-900 mb-1 line-clamp-2\",children:book.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-2 flex items-center\",children:[/*#__PURE__*/_jsx(FaUser,{className:\"w-3 h-3 mr-1\"}),book.author]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-2 flex items-center\",children:[/*#__PURE__*/_jsx(FaTags,{className:\"w-3 h-3 mr-1\"}),((_book$category=book.category)===null||_book$category===void 0?void 0:_book$category.name)||'Chưa phân loại']}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-lg font-bold text-blue-600\",children:formatCurrency(book.price)}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-500\",children:[\"Kho: \",book.quantity]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsxs(Link,{to:`/books/${book._id}`,className:\"flex-1 px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded hover:bg-gray-200 flex items-center justify-center\",children:[/*#__PURE__*/_jsx(FaEye,{className:\"w-3 h-3 mr-1\"}),\"Xem\"]}),/*#__PURE__*/_jsxs(Link,{to:`/admin/books/edit/${book._id}`,className:\"flex-1 px-3 py-2 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 flex items-center justify-center\",children:[/*#__PURE__*/_jsx(FaEdit,{className:\"w-3 h-3 mr-1\"}),\"S\\u1EEDa\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openDeleteModal(book),className:\"px-3 py-2 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 flex items-center justify-center\",children:/*#__PURE__*/_jsx(FaTrash,{className:\"w-3 h-3\"})})]})]})]},book._id);})})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center sm:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:\"Qu\\u1EA3n l\\xFD S\\xE1ch\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-1\",children:booksResponse?`${booksResponse.totalItems.toLocaleString()} sách`:'Đang tải...'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 sm:mt-0 flex space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowFilters(!showFilters),className:\"px-4 py-2 bg-gray-100 text-gray-700 font-medium rounded-md hover:bg-gray-200 flex items-center\",children:[/*#__PURE__*/_jsx(FaFilter,{className:\"w-4 h-4 mr-2\"}),\"B\\u1ED9 l\\u1ECDc\"]}),/*#__PURE__*/_jsxs(Link,{to:\"/admin/books/new\",className:\"px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 flex items-center\",children:[/*#__PURE__*/_jsx(FaPlus,{className:\"w-4 h-4 mr-2\"}),\"Th\\xEAm s\\xE1ch m\\u1EDBi\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSearch,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(FaSearch,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),placeholder:\"T\\xECm ki\\u1EBFm theo t\\xEAn s\\xE1ch, t\\xE1c gi\\u1EA3...\",className:\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"})]})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700\",children:\"T\\xECm ki\\u1EBFm\"})]}),showFilters&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Danh m\\u1EE5c\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedCategory,onChange:e=>setSelectedCategory(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3 danh m\\u1EE5c\"}),categories===null||categories===void 0?void 0:categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category._id,children:category.name},category._id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"S\\u1EAFp x\\u1EBFp theo\"}),/*#__PURE__*/_jsxs(\"select\",{value:sortBy,onChange:e=>setSortBy(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"createdAt\",children:\"Ng\\xE0y t\\u1EA1o\"}),/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"T\\xEAn s\\xE1ch\"}),/*#__PURE__*/_jsx(\"option\",{value:\"price\",children:\"Gi\\xE1\"}),/*#__PURE__*/_jsx(\"option\",{value:\"quantity\",children:\"S\\u1ED1 l\\u01B0\\u1EE3ng\"}),/*#__PURE__*/_jsx(\"option\",{value:\"sold\",children:\"\\u0110\\xE3 b\\xE1n\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Th\\u1EE9 t\\u1EF1\"}),/*#__PURE__*/_jsxs(\"select\",{value:sortDir,onChange:e=>setSortDir(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"desc\",children:\"Gi\\u1EA3m d\\u1EA7n\"}),/*#__PURE__*/_jsx(\"option\",{value:\"asc\",children:\"T\\u0103ng d\\u1EA7n\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleFilterChange,className:\"px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700\",children:\"\\xC1p d\\u1EE5ng\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:clearFilters,className:\"px-4 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700\",children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:(booksResponse===null||booksResponse===void 0?void 0:booksResponse.totalItems)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"T\\u1ED5ng s\\xE1ch\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:(booksResponse===null||booksResponse===void 0?void 0:(_booksResponse$data=booksResponse.data)===null||_booksResponse$data===void 0?void 0:_booksResponse$data.filter(book=>book.quantity>0).length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"C\\xF2n h\\xE0ng\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-red-600\",children:(booksResponse===null||booksResponse===void 0?void 0:(_booksResponse$data2=booksResponse.data)===null||_booksResponse$data2===void 0?void 0:_booksResponse$data2.filter(book=>book.quantity===0).length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"H\\u1EBFt h\\xE0ng\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-yellow-600\",children:(booksResponse===null||booksResponse===void 0?void 0:(_booksResponse$data3=booksResponse.data)===null||_booksResponse$data3===void 0?void 0:_booksResponse$data3.filter(book=>book.quantity>0&&book.quantity<10).length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"S\\u1EAFp h\\u1EBFt\"})]})]})}),(booksResponse===null||booksResponse===void 0?void 0:booksResponse.data)&&booksResponse.data.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:selectAllBooks,className:\"text-sm text-blue-600 hover:text-blue-800\",children:\"Ch\\u1ECDn t\\u1EA5t c\\u1EA3 trang n\\xE0y\"}),selectedBooks.length>0&&/*#__PURE__*/_jsx(\"button\",{onClick:clearSelection,className:\"text-sm text-gray-600 hover:text-gray-800\",children:\"B\\u1ECF ch\\u1ECDn t\\u1EA5t c\\u1EA3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"Hi\\u1EC3n th\\u1ECB \",booksResponse.data.length,\" tr\\xEAn \",booksResponse.totalItems,\" s\\xE1ch\"]})]})]}),renderContent(),booksResponse&&booksResponse.totalPages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center\",children:/*#__PURE__*/_jsx(Pagination,{currentPage:booksResponse.currentPage+1,totalPages:booksResponse.totalPages,onPageChange:handlePageChange})}),bookToDelete&&/*#__PURE__*/_jsx(ConfirmModal,{isOpen:isModalOpen,onClose:closeDeleteModal,onConfirm:handleDeleteBook,title:\"X\\xE1c nh\\u1EADn x\\xF3a s\\xE1ch\",message:`Bạn có chắc chắn muốn xóa sách \"${bookToDelete.title}\"? Hành động này không thể hoàn tác.`,variant:\"danger\",confirmText:\"X\\xF3a\"})]});};export default AdminBookManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}