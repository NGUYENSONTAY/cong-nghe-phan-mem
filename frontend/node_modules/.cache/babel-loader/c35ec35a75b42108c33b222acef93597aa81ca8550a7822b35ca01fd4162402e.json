{"ast":null,"code":"import React,{useState}from'react';import{useQuery,useMutation,useQueryClient}from'react-query';import toast from'react-hot-toast';import{categoryAPI}from'../../api/categoryAPI';import Loading from'../../components/common/Loading';import{ConfirmModal}from'../../components/common/Modal';import{FaEdit,FaTrash}from'react-icons/fa';// Reusable Category Modal Form\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CategoryModal=_ref=>{let{isOpen,onClose,onSubmit,initialData}=_ref;const[name,setName]=useState((initialData===null||initialData===void 0?void 0:initialData.name)||'');React.useEffect(()=>{setName((initialData===null||initialData===void 0?void 0:initialData.name)||'');},[initialData]);const handleSubmit=e=>{e.preventDefault();if(!name.trim()){toast.error('Tên danh mục không được để trống!');return;}onSubmit({name});};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:initialData?'Sửa Danh Mục':'Thêm Danh Mục Mới'}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category-name\",className:\"block text-sm font-medium text-gray-700\",children:\"T\\xEAn danh m\\u1EE5c\"}),/*#__PURE__*/_jsx(\"input\",{id:\"category-name\",type:\"text\",value:name,onChange:e=>setName(e.target.value),className:\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500\",autoFocus:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300\",children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700\",children:\"L\\u01B0u\"})]})]})]})});};const AdminCategoryManagement=()=>{const queryClient=useQueryClient();const[isModalOpen,setIsModalOpen]=useState(false);const[isConfirmModalOpen,setIsConfirmModalOpen]=useState(false);const[selectedCategory,setSelectedCategory]=useState(null);const[categoryToDelete,setCategoryToDelete]=useState(null);const{data:categories=[],isLoading,error}=useQuery('categories',categoryAPI.getAllCategories);const mutationOptions={onSuccess:()=>{queryClient.invalidateQueries('categories');setIsModalOpen(false);setSelectedCategory(null);},onError:err=>{toast.error(err.message);}};const createMutation=useMutation(categoryAPI.createCategory,{...mutationOptions,onSuccess:()=>{mutationOptions.onSuccess();toast.success('Tạo danh mục thành công!');}});const updateMutation=useMutation(data=>categoryAPI.updateCategory(selectedCategory._id,data),{...mutationOptions,onSuccess:()=>{mutationOptions.onSuccess();toast.success('Cập nhật danh mục thành công!');}});const deleteMutation=useMutation(categoryAPI.deleteCategory,{onSuccess:()=>{queryClient.invalidateQueries('categories');setIsConfirmModalOpen(false);setCategoryToDelete(null);toast.success('Xóa danh mục thành công!');},onError:err=>{toast.error(err.message);}});const handleOpenModal=function(){let category=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;setSelectedCategory(category);setIsModalOpen(true);};const handleFormSubmit=data=>{if(selectedCategory){updateMutation.mutate(data);}else{createMutation.mutate(data);}};const handleDeleteClick=category=>{setCategoryToDelete(category);setIsConfirmModalOpen(true);};const confirmDelete=()=>{if(categoryToDelete){deleteMutation.mutate(categoryToDelete._id);}};if(isLoading)return/*#__PURE__*/_jsx(Loading,{});if(error)return/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-500\",children:[\"\\u0110\\xE3 x\\u1EA3y ra l\\u1ED7i: \",error.message]});return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-800\",children:\"Qu\\u1EA3n L\\xFD Danh M\\u1EE5c\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleOpenModal(),className:\"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\",children:\"+ Th\\xEAm Danh M\\u1EE5c\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow overflow-hidden\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"T\\xEAn Danh M\\u1EE5c\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-3 px-6 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Thao T\\xE1c\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-gray-200\",children:categories.map(category=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"py-4 px-6 whitespace-nowrap font-medium text-gray-900\",children:category.name}),/*#__PURE__*/_jsxs(\"td\",{className:\"py-4 px-6 whitespace-nowrap text-right space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleOpenModal(category),className:\"text-indigo-600 hover:text-indigo-900\",children:/*#__PURE__*/_jsx(FaEdit,{})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteClick(category),className:\"text-red-600 hover:text-red-900\",children:/*#__PURE__*/_jsx(FaTrash,{})})]})]},category._id))})]})}),/*#__PURE__*/_jsx(CategoryModal,{isOpen:isModalOpen,onClose:()=>setIsModalOpen(false),onSubmit:handleFormSubmit,initialData:selectedCategory}),/*#__PURE__*/_jsx(ConfirmModal,{isOpen:isConfirmModalOpen,onClose:()=>setIsConfirmModalOpen(false),onConfirm:confirmDelete,title:\"X\\xE1c nh\\u1EADn x\\xF3a\",message:`Bạn có chắc chắn muốn xóa danh mục \"${categoryToDelete===null||categoryToDelete===void 0?void 0:categoryToDelete.name}\" không?`})]});};export default AdminCategoryManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}