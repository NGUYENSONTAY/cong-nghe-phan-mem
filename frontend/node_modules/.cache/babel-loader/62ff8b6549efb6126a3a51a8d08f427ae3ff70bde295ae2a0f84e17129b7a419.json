{"ast":null,"code":"import React,{useState}from'react';import{useQuery,useMutation,useQueryClient}from'react-query';import toast from'react-hot-toast';import{FaEdit,FaTrash,FaPlus,FaSearch,FaUser,FaSave,FaTimes,FaCalendar,FaGlobe,FaBook}from'react-icons/fa';import{authorAPI}from'../../api/authorAPI';import Loading from'../../components/common/Loading';import{ConfirmModal}from'../../components/common/Modal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminAuthorManagement=()=>{const queryClient=useQueryClient();// State for search and filters\nconst[searchTerm,setSearchTerm]=useState('');const[selectedNationality,setSelectedNationality]=useState('');// State for delete confirmation modal\nconst[isDeleteModalOpen,setIsDeleteModalOpen]=useState(false);const[authorToDelete,setAuthorToDelete]=useState(null);// State for add/edit modal\nconst[isFormModalOpen,setIsFormModalOpen]=useState(false);const[editingAuthor,setEditingAuthor]=useState(null);const[formData,setFormData]=useState({name:'',biography:'',birthDate:'',nationality:''});const{data:authors,isLoading,isError,error}=useQuery('authors',authorAPI.getAllAuthors);const{data:nationalities}=useQuery('nationalities',authorAPI.getAllNationalities);const createMutation=useMutation(authorAPI.createAuthor,{onSuccess:()=>{toast.success('Tạo tác giả thành công!');queryClient.invalidateQueries('authors');closeFormModal();},onError:err=>{toast.error(`Lỗi khi tạo tác giả: ${err.message}`);}});const updateMutation=useMutation(_ref=>{let{id,data}=_ref;return authorAPI.updateAuthor(id,data);},{onSuccess:()=>{toast.success('Cập nhật tác giả thành công!');queryClient.invalidateQueries('authors');closeFormModal();},onError:err=>{toast.error(`Lỗi khi cập nhật tác giả: ${err.message}`);}});const deleteMutation=useMutation(authorAPI.deleteAuthor,{onSuccess:()=>{toast.success('Xóa tác giả thành công!');queryClient.invalidateQueries('authors');closeDeleteModal();},onError:err=>{toast.error(`Lỗi khi xóa tác giả: ${err.message}`);closeDeleteModal();}});const filteredAuthors=(authors===null||authors===void 0?void 0:authors.filter(author=>{var _author$biography,_author$nationality;const matchesSearch=author.name.toLowerCase().includes(searchTerm.toLowerCase())||((_author$biography=author.biography)===null||_author$biography===void 0?void 0:_author$biography.toLowerCase().includes(searchTerm.toLowerCase()))||((_author$nationality=author.nationality)===null||_author$nationality===void 0?void 0:_author$nationality.toLowerCase().includes(searchTerm.toLowerCase()));const matchesNationality=!selectedNationality||author.nationality===selectedNationality;return matchesSearch&&matchesNationality;}))||[];const openCreateModal=()=>{setEditingAuthor(null);setFormData({name:'',biography:'',birthDate:'',nationality:''});setIsFormModalOpen(true);};const openEditModal=author=>{setEditingAuthor(author);setFormData({_id:author._id,name:author.name,biography:author.biography||'',birthDate:author.birthDate||'',nationality:author.nationality||''});setIsFormModalOpen(true);};const closeFormModal=()=>{setIsFormModalOpen(false);setEditingAuthor(null);setFormData({name:'',biography:'',birthDate:'',nationality:''});};const openDeleteModal=author=>{setAuthorToDelete(author);setIsDeleteModalOpen(true);};const closeDeleteModal=()=>{setAuthorToDelete(null);setIsDeleteModalOpen(false);};const handleFormSubmit=e=>{var _formData$biography,_formData$nationality;e.preventDefault();if(!formData.name.trim()){toast.error('Tên tác giả không được để trống');return;}const authorData={name:formData.name.trim(),biography:((_formData$biography=formData.biography)===null||_formData$biography===void 0?void 0:_formData$biography.trim())||'',birthDate:formData.birthDate||'',nationality:((_formData$nationality=formData.nationality)===null||_formData$nationality===void 0?void 0:_formData$nationality.trim())||''};if(editingAuthor){updateMutation.mutate({id:editingAuthor._id,data:authorData});}else{createMutation.mutate(authorData);}};const handleDeleteAuthor=()=>{if(authorToDelete){deleteMutation.mutate(authorToDelete._id);}};const formatDate=dateString=>{if(!dateString)return'—';return new Date(dateString).toLocaleDateString('vi-VN');};const formatDateTime=dateString=>{if(!dateString)return'—';return new Date(dateString).toLocaleString('vi-VN');};const calculateAge=birthDate=>{if(!birthDate)return null;const today=new Date();const birth=new Date(birthDate);const age=today.getFullYear()-birth.getFullYear();const monthDiff=today.getMonth()-birth.getMonth();if(monthDiff<0||monthDiff===0&&today.getDate()<birth.getDate()){return age-1;}return age;};if(isLoading)return/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i danh s\\xE1ch t\\xE1c gi\\u1EA3...\"});if(isError)return/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-500\",children:[\"L\\u1ED7i: \",error.message]});return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row sm:items-center sm:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:\"Qu\\u1EA3n l\\xFD T\\xE1c gi\\u1EA3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-1\",children:authors?`${authors.length} tác giả`:'Đang tải...'})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:openCreateModal,className:\"mt-4 sm:mt-0 px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 flex items-center\",children:[/*#__PURE__*/_jsx(FaPlus,{className:\"w-4 h-4 mr-2\"}),\"Th\\xEAm t\\xE1c gi\\u1EA3 m\\u1EDBi\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(FaSearch,{className:\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),placeholder:\"T\\xECm ki\\u1EBFm t\\xE1c gi\\u1EA3 theo t\\xEAn, ti\\u1EC3u s\\u1EED, qu\\u1ED1c t\\u1ECBch...\",className:\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"select\",{value:selectedNationality,onChange:e=>setSelectedNationality(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3 qu\\u1ED1c t\\u1ECBch\"}),nationalities===null||nationalities===void 0?void 0:nationalities.map(nationality=>/*#__PURE__*/_jsx(\"option\",{value:nationality,children:nationality},nationality))]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-orange-600\",children:(authors===null||authors===void 0?void 0:authors.length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"T\\u1ED5ng t\\xE1c gi\\u1EA3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:filteredAuthors.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"Hi\\u1EC3n th\\u1ECB\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-purple-600\",children:(nationalities===null||nationalities===void 0?void 0:nationalities.length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"Qu\\u1ED1c t\\u1ECBch\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-orange-600\",children:(authors===null||authors===void 0?void 0:authors.length)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"T\\u1ED5ng s\\xE1ch\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200\",children:filteredAuthors.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(FaUser,{className:\"w-16 h-16 text-gray-300 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:searchTerm||selectedNationality?'Không tìm thấy tác giả':'Chưa có tác giả nào'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 mb-6\",children:searchTerm||selectedNationality?'Thử thay đổi từ khóa tìm kiếm hoặc bộ lọc':'Bắt đầu bằng cách thêm tác giả mới'}),!searchTerm&&!selectedNationality&&/*#__PURE__*/_jsxs(\"button\",{onClick:openCreateModal,className:\"inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700\",children:[/*#__PURE__*/_jsx(FaPlus,{className:\"w-4 h-4 mr-2\"}),\"Th\\xEAm t\\xE1c gi\\u1EA3 m\\u1EDBi\"]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"T\\xE1c gi\\u1EA3\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Th\\xF4ng tin\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Ti\\u1EC3u s\\u1EED\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"S\\xE1ch\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:filteredAuthors.map(author=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 h-10 w-10\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center\",children:/*#__PURE__*/_jsx(FaUser,{className:\"h-5 w-5 text-blue-600\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:author.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 flex items-center mt-1\",children:[/*#__PURE__*/_jsx(FaGlobe,{className:\"w-3 h-3 mr-1\"}),author.nationality||'Chưa rõ']})]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-900\",children:[author.birthDate&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-1\",children:[/*#__PURE__*/_jsx(FaCalendar,{className:\"w-3 h-3 mr-1 text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{children:formatDate(author.birthDate)}),calculateAge(author.birthDate)&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-gray-500\",children:[\"(\",calculateAge(author.birthDate),\" tu\\u1ED5i)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"T\\u1EA1o: \",formatDateTime(author.createdAt||'')]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 max-w-xs\",children:author.biography?/*#__PURE__*/_jsx(\"div\",{className:\"truncate\",children:author.biography}):/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 italic\",children:\"Ch\\u01B0a c\\xF3 ti\\u1EC3u s\\u1EED\"})})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-sm text-gray-900\",children:[/*#__PURE__*/_jsx(FaBook,{className:\"w-4 h-4 mr-1 text-green-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 ml-1\",children:\"cu\\u1ED1n\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openEditModal(author),className:\"px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 flex items-center\",children:[/*#__PURE__*/_jsx(FaEdit,{className:\"w-3 h-3 mr-1\"}),\"S\\u1EEDa\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openDeleteModal(author),className:\"px-3 py-1 bg-red-600 text-white text-sm font-medium rounded hover:bg-red-700 flex items-center\",children:[/*#__PURE__*/_jsx(FaTrash,{className:\"w-3 h-3 mr-1\"}),\"X\\xF3a\"]})]})})]},author._id))})]})})}),isFormModalOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:editingAuthor?'Chỉnh sửa tác giả':'Thêm tác giả mới'}),/*#__PURE__*/_jsx(\"button\",{onClick:closeFormModal,className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(FaTimes,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleFormSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"T\\xEAn t\\xE1c gi\\u1EA3 *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.name,onChange:e=>setFormData({...formData,name:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Nh\\u1EADp t\\xEAn t\\xE1c gi\\u1EA3...\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Qu\\u1ED1c t\\u1ECBch\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.nationality,onChange:e=>setFormData({...formData,nationality:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Nh\\u1EADp qu\\u1ED1c t\\u1ECBch...\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Ng\\xE0y sinh\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formData.birthDate,onChange:e=>setFormData({...formData,birthDate:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Ti\\u1EC3u s\\u1EED\"}),/*#__PURE__*/_jsx(\"textarea\",{value:formData.biography,onChange:e=>setFormData({...formData,biography:e.target.value}),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Nh\\u1EADp ti\\u1EC3u s\\u1EED t\\xE1c gi\\u1EA3...\",rows:4})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3 pt-4\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:createMutation.isLoading||updateMutation.isLoading,className:\"flex-1 px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center\",children:[/*#__PURE__*/_jsx(FaSave,{className:\"w-4 h-4 mr-2\"}),createMutation.isLoading||updateMutation.isLoading?'Đang lưu...':'Lưu']}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:closeFormModal,className:\"flex-1 px-4 py-2 bg-gray-600 text-white font-medium rounded-md hover:bg-gray-700 flex items-center justify-center\",children:[/*#__PURE__*/_jsx(FaTimes,{className:\"w-4 h-4 mr-2\"}),\"H\\u1EE7y\"]})]})]})]})})}),authorToDelete&&/*#__PURE__*/_jsx(ConfirmModal,{isOpen:isDeleteModalOpen,onClose:closeDeleteModal,onConfirm:handleDeleteAuthor,title:\"X\\xE1c nh\\u1EADn x\\xF3a t\\xE1c gi\\u1EA3\",message:`Bạn có chắc chắn muốn xóa tác giả \"${authorToDelete.name}\"? Hành động này không thể hoàn tác và có thể ảnh hưởng đến các sách của tác giả này.`,variant:\"danger\",confirmText:\"X\\xF3a\"})]});};export default AdminAuthorManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}