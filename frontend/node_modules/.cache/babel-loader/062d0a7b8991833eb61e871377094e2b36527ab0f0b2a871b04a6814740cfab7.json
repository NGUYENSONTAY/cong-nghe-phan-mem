{"ast":null,"code":"import React,{useEffect}from'react';import{useForm,Controller}from'react-hook-form';import{yupResolver}from'@hookform/resolvers/yup';import*as yup from'yup';import{useQuery}from'react-query';import{categoryAPI}from'../../api/categoryAPI';import Loading from'../common/Loading';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const schema=yup.object().shape({title:yup.string().required('Tên sách là bắt buộc'),author:yup.string().required('Tên tác giả là bắt buộc'),description:yup.string().required('Mô tả là bắt buộc'),price:yup.number().typeError('Giá phải là một con số').positive('Giá phải là số dương').required('Giá là bắt buộc'),quantity:yup.number().typeError('Số lượng phải là một con số').integer('Số lượng phải là số nguyên').min(0,'Số lượng không được âm').required('Số lượng là bắt buộc'),category:yup.string().required('Danh mục là bắt buộc'),images:yup.array().of(yup.string().url('Phải là một URL hợp lệ')).min(1,'Cần ít nhất một hình ảnh').required('Hình ảnh là bắt buộc')});const BookForm=_ref=>{let{onSubmit,initialData,isSubmitting,submitButtonText='Lưu'}=_ref;const{data:categories,isLoading:isLoadingCategories,error:categoriesError}=useQuery('categories',categoryAPI.getAllCategories);const{register,handleSubmit,control,reset,formState:{errors}}=useForm({resolver:yupResolver(schema),defaultValues:{images:[]}});useEffect(()=>{if(initialData){reset({...initialData,category:initialData.category._id});}},[initialData,reset]);const handleFormSubmit=data=>{onSubmit(data);};if(isLoadingCategories)return/*#__PURE__*/_jsx(Loading,{});if(categoriesError)return/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:\"L\\u1ED7i khi t\\u1EA3i danh m\\u1EE5c.\"});return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(handleFormSubmit),className:\"space-y-6 bg-white p-8 rounded-lg shadow-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",className:\"block text-sm font-medium text-gray-700\",children:\"T\\xEAn s\\xE1ch\"}),/*#__PURE__*/_jsx(\"input\",{id:\"title\",type:\"text\",...register('title'),className:`mt-1 block w-full px-3 py-2 border ${errors.title?'border-red-500':'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),errors.title&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.title.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"author\",className:\"block text-sm font-medium text-gray-700\",children:\"T\\xE1c gi\\u1EA3\"}),/*#__PURE__*/_jsx(\"input\",{id:\"author\",type:\"text\",...register('author'),className:`mt-1 block w-full px-3 py-2 border ${errors.author?'border-red-500':'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),errors.author&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.author.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",className:\"block text-sm font-medium text-gray-700\",children:\"M\\xF4 t\\u1EA3\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"description\",rows:4,...register('description'),className:`mt-1 block w-full px-3 py-2 border ${errors.description?'border-red-500':'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),errors.description&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.description.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"price\",className:\"block text-sm font-medium text-gray-700\",children:\"Gi\\xE1\"}),/*#__PURE__*/_jsx(\"input\",{id:\"price\",type:\"number\",...register('price'),className:`mt-1 block w-full px-3 py-2 border ${errors.price?'border-red-500':'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),errors.price&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.price.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"quantity\",className:\"block text-sm font-medium text-gray-700\",children:\"S\\u1ED1 l\\u01B0\\u1EE3ng\"}),/*#__PURE__*/_jsx(\"input\",{id:\"quantity\",type:\"number\",...register('quantity'),className:`mt-1 block w-full px-3 py-2 border ${errors.quantity?'border-red-500':'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`}),errors.quantity&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.quantity.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category\",className:\"block text-sm font-medium text-gray-700\",children:\"Danh m\\u1EE5c\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"category\",...register('category'),className:`mt-1 block w-full px-3 py-2 border ${errors.category?'border-red-500':'border-gray-300'} bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Ch\\u1ECDn danh m\\u1EE5c\"}),categories===null||categories===void 0?void 0:categories.map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat._id,children:cat.name},cat._id))]}),errors.category&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.category.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"images\",className:\"block text-sm font-medium text-gray-700\",children:[\"H\\xECnh \\u1EA3nh (URLs)\",/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500\",children:\" (M\\u1ED7i URL tr\\xEAn m\\u1ED9t d\\xF2ng)\"})]}),/*#__PURE__*/_jsx(Controller,{name:\"images\",control:control,render:_ref2=>{let{field}=_ref2;return/*#__PURE__*/_jsx(\"textarea\",{id:\"images\",rows:4,className:`mt-1 block w-full px-3 py-2 border ${errors.images?'border-red-500':'border-gray-300'} rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500`,value:Array.isArray(field.value)?field.value.join('\\n'):'',onChange:e=>{const urls=e.target.value.split('\\n').map(url=>url.trim()).filter(url=>url);field.onChange(urls);}});}}),errors.images&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-red-600\",children:errors.images.message})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSubmitting,className:\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-300\",children:isSubmitting?'Đang xử lý...':submitButtonText})})]});};export default BookForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}