{"ast":null,"code":"import React,{useState,useEffect,useMemo}from'react';import{useSearchParams}from'react-router-dom';import{booksAPI}from'../api/booksAPI';import BookCard from'../components/common/BookCard';import Pagination from'../components/common/Pagination';import FilterSidebar from'../components/books/FilterSidebar';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const sortOptions=[{value:'default',label:'Mặc định',field:'_id',direction:'asc'},{value:'price_asc',label:'Giá: Thấp đến cao',field:'price',direction:'asc'},{value:'price_desc',label:'Giá: Cao đến thấp',field:'price',direction:'desc'},{value:'title_asc',label:'Tên: A-Z',field:'title',direction:'asc'},{value:'title_desc',label:'Tên: Z-A',field:'title',direction:'desc'},{value:'latest',label:'Mới nhất',field:'createdAt',direction:'desc'}];const BooksPage=()=>{const[searchParams,setSearchParams]=useSearchParams();const[booksResponse,setBooksResponse]=useState(null);const[loading,setLoading]=useState(true);const{page,limit,filters}=useMemo(()=>{const page=parseInt(searchParams.get('page')||'1',10);const limit=parseInt(searchParams.get('limit')||'12',10);const filterParams={};searchParams.forEach((value,key)=>{if(key!=='page'&&key!=='limit'){filterParams[key]=value;}});return{page,limit,filters:filterParams};},[searchParams]);useEffect(()=>{const fetchBooks=async()=>{try{setLoading(true);// API uses 0-indexed pages, UI uses 1-indexed pages\nconst apiPage=page-1;const response=await booksAPI.getBooks(apiPage,limit,filters);setBooksResponse(response);}catch(error){toast.error('Không thể tải danh sách sách');console.error('Failed to fetch books:',error);}finally{setLoading(false);}};fetchBooks();window.scrollTo(0,0);},[page,limit,filters]);const updateSearchParams=newFilters=>{const currentParams=Object.fromEntries(searchParams.entries());const isFilterChange=Object.keys(newFilters).some(k=>k!=='page');const updatedParams={...currentParams,...newFilters};if(isFilterChange){updatedParams.page='1';}Object.keys(updatedParams).forEach(key=>{if(updatedParams[key]===''||updatedParams[key]===null||updatedParams[key]===undefined){delete updatedParams[key];}});setSearchParams(updatedParams);};const handlePageChange=newPage=>{updateSearchParams({page:newPage});};const handleSortChange=e=>{const selectedSort=sortOptions.find(opt=>opt.value===e.target.value);if(selectedSort&&selectedSort.value!=='default'){updateSearchParams({sortBy:selectedSort.field,sortDir:selectedSort.direction});}else{const newParams=Object.fromEntries(searchParams.entries());delete newParams.sortBy;delete newParams.sortDir;setSearchParams(newParams);}};const renderSkeletons=()=>/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\",children:Array.from({length:12}).map((_,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"book-card animate-pulse\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-300 h-64 w-full rounded-lg\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-4 bg-gray-300 rounded w-3/4 mb-2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-4 bg-gray-300 rounded w-1/2\"})]})]},index))});const getSortValue=()=>{const sortBy=searchParams.get('sortBy');const sortDir=searchParams.get('sortDir');if(!sortBy)return'default';const option=sortOptions.find(opt=>opt.field===sortBy&&opt.direction===sortDir);return option?option.value:'default';};return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 min-h-screen\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-8 bg-white p-6 rounded-lg shadow-sm border\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold text-gray-800\",children:\"Kh\\xE1m Ph\\xE1 S\\xE1ch\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-2\",children:\"T\\xECm ki\\u1EBFm v\\xE0 l\\u1EF1a ch\\u1ECDn nh\\u1EEFng cu\\u1ED1n s\\xE1ch y\\xEAu th\\xEDch c\\u1EE7a b\\u1EA1n\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row gap-8\",children:[/*#__PURE__*/_jsx(FilterSidebar,{onFilterChange:updateSearchParams,initialFilters:filters}),/*#__PURE__*/_jsxs(\"main\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-4 rounded-lg shadow-sm border\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 mb-2 md:mb-0\",children:[\"Hi\\u1EC3n th\\u1ECB \",(booksResponse===null||booksResponse===void 0?void 0:booksResponse.data.length)||0,\" tr\\xEAn t\\u1ED5ng s\\u1ED1 \",(booksResponse===null||booksResponse===void 0?void 0:booksResponse.totalItems)||0,\" k\\u1EBFt qu\\u1EA3\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"sort\",className:\"text-sm font-medium\",children:\"S\\u1EAFp x\\u1EBFp:\"}),/*#__PURE__*/_jsx(\"select\",{id:\"sort\",onChange:handleSortChange,value:getSortValue(),className:\"select select-bordered select-sm\",children:sortOptions.map(opt=>/*#__PURE__*/_jsx(\"option\",{value:opt.value,children:opt.label},opt.value))})]})]}),loading?renderSkeletons():booksResponse&&booksResponse.data.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6\",children:booksResponse.data.map(book=>/*#__PURE__*/_jsx(BookCard,{book:book},book._id))}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-16 bg-white rounded-lg shadow-sm border\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y s\\xE1ch ph\\xF9 h\\u1EE3p\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-2\",children:\"Vui l\\xF2ng th\\u1EED l\\u1EA1i v\\u1EDBi b\\u1ED9 l\\u1ECDc kh\\xE1c.\"})]}),booksResponse&&booksResponse.totalPages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-8\",children:/*#__PURE__*/_jsx(Pagination,{currentPage:booksResponse.currentPage+1,totalPages:booksResponse.totalPages,onPageChange:handlePageChange})})]})]})]})});};export default BooksPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}