{"ast":null,"code":"import React,{createContext,useContext}from'react';import toast from'react-hot-toast';import useLocalStorage from'../hooks/useLocalStorage';import{jsx as _jsx}from\"react/jsx-runtime\";const CartContext=/*#__PURE__*/createContext(undefined);export const CartProvider=_ref=>{let{children}=_ref;const[items,setItems]=useLocalStorage('cart_items',[]);const addToCart=(book,quantity)=>{setItems(prevItems=>{const existingItem=prevItems.find(item=>item._id===book._id);const availableStock=book.quantity-((existingItem===null||existingItem===void 0?void 0:existingItem.quantity)||0);if(quantity>availableStock){toast.error(`Rất tiếc, chỉ còn ${book.quantity} sản phẩm có sẵn.`);return prevItems;}if(existingItem){return prevItems.map(item=>item._id===book._id?{...item,quantity:item.quantity+quantity}:item);}else{const newItem={_id:book._id,title:book.title,price:book.price,image:book.images[0],quantity,stock:book.quantity};return[...prevItems,newItem];}});toast.success(`Đã thêm \"${book.title}\" vào giỏ hàng.`);};const removeFromCart=bookId=>{setItems(prevItems=>prevItems.filter(item=>item._id!==bookId));toast.success(\"Đã xóa sản phẩm khỏi giỏ hàng.\");};const updateQuantity=(bookId,newQuantity)=>{setItems(prevItems=>{const itemToUpdate=prevItems.find(item=>item._id===bookId);if(!itemToUpdate)return prevItems;if(newQuantity<=0){return prevItems.filter(item=>item._id!==bookId);}if(newQuantity>itemToUpdate.stock){toast.error(`Số lượng tồn kho không đủ. Chỉ còn ${itemToUpdate.stock} sản phẩm.`);return prevItems.map(item=>item._id===bookId?{...item,quantity:itemToUpdate.stock}:item);}return prevItems.map(item=>item._id===bookId?{...item,quantity:newQuantity}:item);});};const clearCart=()=>{setItems([]);};const getItemQuantity=bookId=>{const item=items.find(i=>i._id===bookId);return(item===null||item===void 0?void 0:item.quantity)||0;};const cart=React.useMemo(()=>{const totalItems=items.reduce((count,item)=>count+item.quantity,0);const totalAmount=items.reduce((total,item)=>total+item.price*item.quantity,0);return{items,totalItems,totalAmount};},[items]);const value={cart,addToCart,removeFromCart,updateQuantity,clearCart,getItemQuantity};return/*#__PURE__*/_jsx(CartContext.Provider,{value:value,children:children});};export const useCart=()=>{const context=useContext(CartContext);if(context===undefined){throw new Error('useCart must be used within a CartProvider');}return context;};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}