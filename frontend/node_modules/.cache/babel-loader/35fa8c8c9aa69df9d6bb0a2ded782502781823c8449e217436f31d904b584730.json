{"ast":null,"code":"import React from'react';import{useParams,Link}from'react-router-dom';import{useQuery,useMutation,useQueryClient}from'react-query';import toast from'react-hot-toast';import{orderAPI}from'../../api/orderAPI';import Loading from'../../components/common/Loading';import{FaArrowLeft,FaCalendar,FaUser,FaMapMarkerAlt,FaCreditCard}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminOrderDetail=()=>{const{id}=useParams();const queryClient=useQueryClient();const{data:order,isLoading,error}=useQuery(['order',id],()=>orderAPI.getOrderById(id),{enabled:!!id});const updateStatusMutation=useMutation(_ref=>{let{orderId,status}=_ref;return orderAPI.updateOrderStatus(orderId,status);},{onSuccess:updatedOrder=>{queryClient.setQueryData(['order',id],updatedOrder);queryClient.invalidateQueries(['adminOrders']);toast.success('Cập nhật trạng thái đơn hàng thành công!');},onError:error=>{toast.error(`Lỗi: ${error.message}`);}});const handleStatusChange=newStatus=>{if(order&&id){updateStatusMutation.mutate({orderId:id,status:newStatus});}};const getStatusColor=status=>{switch(status){case'PENDING':return'bg-yellow-100 text-yellow-800';case'PROCESSING':return'bg-blue-100 text-blue-800';case'SHIPPED':return'bg-indigo-100 text-indigo-800';case'DELIVERED':return'bg-green-100 text-green-800';case'CANCELLED':return'bg-red-100 text-red-800';default:return'bg-gray-100 text-gray-800';}};const getStatusText=status=>{switch(status){case'PENDING':return'Chờ xử lý';case'PROCESSING':return'Đã xác nhận';case'SHIPPED':return'Đang giao';case'DELIVERED':return'Đã giao';case'CANCELLED':return'Đã hủy';default:return status;}};const formatCurrency=amount=>{return new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND'}).format(amount);};const formatDateTime=dateString=>{return new Date(dateString).toLocaleString('vi-VN');};if(isLoading)return/*#__PURE__*/_jsx(Loading,{text:\"\\u0110ang t\\u1EA3i chi ti\\u1EBFt \\u0111\\u01A1n h\\xE0ng...\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-500\",children:[\"L\\u1ED7i: \",error.message]});if(!order)return/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y \\u0111\\u01A1n h\\xE0ng\"});const canUpdateStatus=(currentStatus,newStatus)=>{// Define business rules for status transitions\nswitch(currentStatus){case'PENDING':return['PROCESSING','CANCELLED'].includes(newStatus);case'PROCESSING':return['SHIPPED','CANCELLED'].includes(newStatus);case'SHIPPED':return['DELIVERED'].includes(newStatus);default:return false;}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/admin/orders\",className:\"flex items-center text-gray-600 hover:text-gray-900\",children:[/*#__PURE__*/_jsx(FaArrowLeft,{className:\"w-4 h-4 mr-2\"}),\"Quay l\\u1EA1i danh s\\xE1ch\"]}),/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:[\"\\u0110\\u01A1n h\\xE0ng #\",order._id]})]}),/*#__PURE__*/_jsx(\"div\",{className:`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(order.status)}`,children:getStatusText(order.status)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"S\\u1EA3n ph\\u1EA9m \\u0111\\xE3 \\u0111\\u1EB7t\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:order.items.map((item,index)=>{var _item$book$images;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between border-b border-gray-200 pb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"img\",{src:((_item$book$images=item.book.images)===null||_item$book$images===void 0?void 0:_item$book$images[0])||'/placeholder-book.jpg',alt:item.book.title,className:\"w-16 h-20 object-cover rounded\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:item.book.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:item.book.author}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[\"S\\u1ED1 l\\u01B0\\u1EE3ng: \",item.quantity]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-gray-900\",children:formatCurrency(item.price)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"T\\u1ED5ng: \",formatCurrency(item.price*item.quantity)]})]})]},index);})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 pt-4 border-t border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-lg font-semibold text-gray-900\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"T\\u1ED5ng c\\u1ED9ng:\"}),/*#__PURE__*/_jsx(\"span\",{children:formatCurrency(order.totalAmount)})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"C\\u1EADp nh\\u1EADt tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-3\",children:['PROCESSING','SHIPPED','DELIVERED','CANCELLED'].map(status=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleStatusChange(status),disabled:!canUpdateStatus(order.status,status)||updateStatusMutation.isLoading,className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${canUpdateStatus(order.status,status)?'bg-blue-600 text-white hover:bg-blue-700':'bg-gray-200 text-gray-400 cursor-not-allowed'}`,children:getStatusText(status)},status))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(FaUser,{className:\"w-4 h-4 mr-2\"}),\"Th\\xF4ng tin kh\\xE1ch h\\xE0ng\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"T\\xEAn:\"}),' ',/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:order.user.name})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Email:\"}),' ',/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:order.user.email})]}),order.user.phone&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"\\u0110i\\u1EC7n tho\\u1EA1i:\"}),' ',/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:order.user.phone})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(FaMapMarkerAlt,{className:\"w-4 h-4 mr-2\"}),\"\\u0110\\u1ECBa ch\\u1EC9 giao h\\xE0ng\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-700\",children:order.address})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(FaCreditCard,{className:\"w-4 h-4 mr-2\"}),\"Thanh to\\xE1n\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Ph\\u01B0\\u01A1ng th\\u1EE9c:\"}),' ',/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"COD\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(FaCalendar,{className:\"w-4 h-4 mr-2\"}),\"Th\\u1EDDi gian\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Ng\\xE0y \\u0111\\u1EB7t:\"}),' ',/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:formatDateTime(order.createdAt)})]}),order.updatedAt&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"C\\u1EADp nh\\u1EADt:\"}),' ',/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:formatDateTime(order.updatedAt)})]})]})]})]})]})]});};export default AdminOrderDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}